function [c_nm]=fun_FFT2D_new_vecnm_harm(fun_xy,nm_harm,X,Y)

NGauss = 2; % for cubuc spline, exact quadrature for NGauss >= 2


% 2D FOURIER SERIES
x = X(1,:);
y = Y(:,1)';

% % [z,w] = MacGaussQuad1D(NGauss);
[xx,ww] = fun_GaussPoints_1D_MB(NGauss);
w = ww.';
z = xx.';

x0 = (x(1:end-1)+x(2:end))*0.5;
hx2 = diff(x)*0.5;
xx = z'*hx2 + ones(size(z'))*x0;
whx = w'*hx2;
xx = xx(:);
whx=whx(:);

y0 = (y(1:end-1)+y(2:end))*0.5;
hy2 = diff(y)*0.5;
yy = z'*hy2 + ones(size(z'))*y0;
why = w'*hy2;
yy = yy(:);
why=why(:);

[XX,YY]=meshgrid(xx,yy);

% % ZZ=griddata(X,Y,fun_xy,XX,YY,'cubic');
ZZ = interp2(X,Y,fun_xy,XX,YY,'spline'); % best accuracy

% % tic
% % [c_n] = fun_compute2DFouruerCoeff(nn,mm,XX,YY,ZZ,whx,why);

nn = nm_harm(:,1);
mm = nm_harm(:,2);

% % [c_n] = fun_compute2DFouruerCoeff_nm_harm(nn,mm,XX,YY,ZZ,whx,why);
[c_nm] = fun_compute2DFouruerCoeff_nm_harm_mex(nn,mm,XX,YY,ZZ,whx,why);


end

function [x,w] = MacGaussQuad1D(n)

%% Compute rule for 1D for interval [-1,1], with the order = n

eps = 2.0e-15;
xstart = -1.0;  xstop = 1.0;

x = zeros(1,n);
w = zeros(1,n);

m  = round((n+1)/2);
xm = 0.5*(xstop+xstart);
xl = 0.5*(xstop-xstart);

if n>1
    for j1=1:m
        z = cos(pi*(j1-0.25)/(n+0.5));
        z1 = 2*z;
        while (abs(z-z1)>eps)
            p1=1.0;
            p2=0.0;
            for j2=1:n
                p3=p2;
                p2=p1;
                p1=((2.0*j2-1.0)*z*p2-(j2-1.0)*p3)/j2;
            end
            pp=n*(z*p1-p2)/(z*z-1);
            z1=z;
            z=z1-p1/pp;
        end
        k=n+1-j1;
        x(j1)=xm-xl*z;
        x(k)=xm+xl*z;
        w(j1)=2*xl/((1-z*z)*pp*pp);
        w(k)=w(j1);
    end
end

if n==1
    x(1) = 0.0;
    w(1) = 2.0;
end
end


function [xx,ww] = fun_GaussPoints_1D_MB(nn)


xx = zeros(nn,1);
ww = zeros(nn,1);


if nn == 1
    
    xx(1) = 0.0000000000000000;
    
    ww(1) = 2.0000000000000000;
    
elseif nn == 2
    
    xx(1) = -0.5773502691896257;
    xx(2) = 0.5773502691896257;
    
    ww(1) = 0.9999999999999998;
    ww(2) = 0.9999999999999998;
    
elseif nn == 3
    
    xx(1) = -0.7745966692414834;
    xx(2) = 0.0000000000000000;
    xx(3) = 0.7745966692414834;
    
    ww(1) = 0.5555555555555544;
    ww(2) = 0.8888888888888888;
    ww(3) = 0.5555555555555544;
    
elseif nn == 4
    
    xx(1) = -0.8611363115940525;
    xx(2) = -0.3399810435848563;
    xx(3) = 0.3399810435848563;
    xx(4) = 0.8611363115940525;
    
    ww(1) = 0.3478548451374544;
    ww(2) = 0.6521451548625460;
    ww(3) = 0.6521451548625460;
    ww(4) = 0.3478548451374544;
    
elseif nn == 5
    
    xx(1) = -0.9061798459386639;
    xx(2) = -0.5384693101056830;
    xx(3) = 0.0000000000000000;
    xx(4) = 0.5384693101056830;
    xx(5) = 0.9061798459386639;
    
    ww(1) = 0.2369268850561891;
    ww(2) = 0.4786286704993662;
    ww(3) = 0.5688888888888889;
    ww(4) = 0.4786286704993662;
    ww(5) = 0.2369268850561891;
    
elseif nn == 6
    
    xx(1) = -0.9324695142031521;
    xx(2) = -0.6612093864662645;
    xx(3) = -0.2386191860831969;
    xx(4) = 0.2386191860831969;
    xx(5) = 0.6612093864662645;
    xx(6) = 0.9324695142031521;
    
    ww(1) = 0.1713244923791705;
    ww(2) = 0.3607615730481387;
    ww(3) = 0.4679139345726910;
    ww(4) = 0.4679139345726910;
    ww(5) = 0.3607615730481387;
    ww(6) = 0.1713244923791705;
    
elseif nn == 7
    
    xx(1) = -0.9491079123427584;
    xx(2) = -0.7415311855993945;
    xx(3) = -0.4058451513773971;
    xx(4) = 0.0000000000000000;
    xx(5) = 0.4058451513773971;
    xx(6) = 0.7415311855993945;
    xx(7) = 0.9491079123427584;
    
    ww(1) = 0.1294849661688696;
    ww(2) = 0.2797053914892768;
    ww(3) = 0.3818300505051190;
    ww(4) = 0.4179591836734693;
    ww(5) = 0.3818300505051190;
    ww(6) = 0.2797053914892768;
    ww(7) = 0.1294849661688696;
    
elseif nn == 8
    
    xx(1) = -0.9602898564975364;
    xx(2) = -0.7966664774136267;
    xx(3) = -0.5255324099163290;
    xx(4) = -0.1834346424956498;
    xx(5) = 0.1834346424956498;
    xx(6) = 0.5255324099163290;
    xx(7) = 0.7966664774136267;
    xx(8) = 0.9602898564975364;
    
    ww(1) = 0.1012285362903768;
    ww(2) = 0.2223810344533744;
    ww(3) = 0.3137066458778873;
    ww(4) = 0.3626837833783621;
    ww(5) = 0.3626837833783621;
    ww(6) = 0.3137066458778873;
    ww(7) = 0.2223810344533744;
    ww(8) = 0.1012285362903768;
    
elseif nn == 9
    
    xx(1) = -0.9681602395076261;
    xx(2) = -0.8360311073266358;
    xx(3) = -0.6133714327005904;
    xx(4) = -0.3242534234038090;
    xx(5) = 0.0000000000000000;
    xx(6) = 0.3242534234038090;
    xx(7) = 0.6133714327005904;
    xx(8) = 0.8360311073266358;
    xx(9) = 0.9681602395076261;
    
    ww(1) = 0.0812743883615746;
    ww(2) = 0.1806481606948574;
    ww(3) = 0.2606106964029355;
    ww(4) = 0.3123470770400029;
    ww(5) = 0.3302393550012598;
    ww(6) = 0.3123470770400029;
    ww(7) = 0.2606106964029355;
    ww(8) = 0.1806481606948574;
    ww(9) = 0.0812743883615746;
    
elseif nn == 10
    
    xx(1) = -0.9739065285171717;
    xx(2) = -0.8650633666889846;
    xx(3) = -0.6794095682990244;
    xx(4) = -0.4333953941292472;
    xx(5) = -0.1488743389816312;
    xx(6) = 0.1488743389816312;
    xx(7) = 0.4333953941292472;
    xx(8) = 0.6794095682990244;
    xx(9) = 0.8650633666889846;
    xx(10) = 0.9739065285171717;
    
    ww(1) = 0.0666713443086880;
    ww(2) = 0.1494513491505806;
    ww(3) = 0.2190863625159821;
    ww(4) = 0.2692667193099962;
    ww(5) = 0.2955242247147529;
    ww(6) = 0.2955242247147529;
    ww(7) = 0.2692667193099962;
    ww(8) = 0.2190863625159821;
    ww(9) = 0.1494513491505806;
    ww(10) = 0.0666713443086880;
    
elseif nn == 11
    
    xx(1) = -0.9782286581460569;
    xx(2) = -0.8870625997680954;
    xx(3) = -0.7301520055740494;
    xx(4) = -0.5190961292068117;
    xx(5) = -0.2695431559523449;
    xx(6) = 0.0000000000000000;
    xx(7) = 0.2695431559523449;
    xx(8) = 0.5190961292068117;
    xx(9) = 0.7301520055740494;
    xx(10) = 0.8870625997680954;
    xx(11) = 0.9782286581460569;
    
    ww(1) = 0.0556685671161735;
    ww(2) = 0.1255803694649041;
    ww(3) = 0.1862902109277340;
    ww(4) = 0.2331937645919902;
    ww(5) = 0.2628045445102467;
    ww(6) = 0.2729250867779006;
    ww(7) = 0.2628045445102467;
    ww(8) = 0.2331937645919902;
    ww(9) = 0.1862902109277340;
    ww(10) = 0.1255803694649041;
    ww(11) = 0.0556685671161735;
    
elseif nn == 12
    
    xx(1) = -0.9815606342467191;
    xx(2) = -0.9041172563704749;
    xx(3) = -0.7699026741943047;
    xx(4) = -0.5873179542866174;
    xx(5) = -0.3678314989981801;
    xx(6) = -0.1252334085114689;
    xx(7) = 0.1252334085114689;
    xx(8) = 0.3678314989981801;
    xx(9) = 0.5873179542866174;
    xx(10) = 0.7699026741943047;
    xx(11) = 0.9041172563704749;
    xx(12) = 0.9815606342467191;
    
    ww(1) = 0.0471753363865118;
    ww(2) = 0.1069393259953181;
    ww(3) = 0.1600783285433461;
    ww(4) = 0.2031674267230658;
    ww(5) = 0.2334925365383548;
    ww(6) = 0.2491470458134029;
    ww(7) = 0.2491470458134029;
    ww(8) = 0.2334925365383548;
    ww(9) = 0.2031674267230658;
    ww(10) = 0.1600783285433461;
    ww(11) = 0.1069393259953181;
    ww(12) = 0.0471753363865118;
    
elseif nn == 13
    
    xx(1) = -0.9841830547185881;
    xx(2) = -0.9175983992229779;
    xx(3) = -0.8015780907333099;
    xx(4) = -0.6423493394403401;
    xx(5) = -0.4484927510364469;
    xx(6) = -0.2304583159551348;
    xx(7) = 0.0000000000000000;
    xx(8) = 0.2304583159551348;
    xx(9) = 0.4484927510364469;
    xx(10) = 0.6423493394403401;
    xx(11) = 0.8015780907333099;
    xx(12) = 0.9175983992229779;
    xx(13) = 0.9841830547185881;
    
    ww(1) = 0.0404840047653158;
    ww(2) = 0.0921214998377284;
    ww(3) = 0.1388735102197871;
    ww(4) = 0.1781459807619457;
    ww(5) = 0.2078160475368883;
    ww(6) = 0.2262831802628971;
    ww(7) = 0.2325515532308739;
    ww(8) = 0.2262831802628971;
    ww(9) = 0.2078160475368883;
    ww(10) = 0.1781459807619457;
    ww(11) = 0.1388735102197871;
    ww(12) = 0.0921214998377284;
    ww(13) = 0.0404840047653158;
    
elseif nn == 14
    
    xx(1) = -0.9862838086968124;
    xx(2) = -0.9284348836635736;
    xx(3) = -0.8272013150697650;
    xx(4) = -0.6872929048116854;
    xx(5) = -0.5152486363581541;
    xx(6) = -0.3191123689278897;
    xx(7) = -0.1080549487073437;
    xx(8) = 0.1080549487073437;
    xx(9) = 0.3191123689278897;
    xx(10) = 0.5152486363581541;
    xx(11) = 0.6872929048116854;
    xx(12) = 0.8272013150697650;
    xx(13) = 0.9284348836635736;
    xx(14) = 0.9862838086968124;
    
    ww(1) = 0.0351194603317520;
    ww(2) = 0.0801580871597600;
    ww(3) = 0.1215185706879032;
    ww(4) = 0.1572031671581936;
    ww(5) = 0.1855383974779378;
    ww(6) = 0.2051984637212957;
    ww(7) = 0.2152638534631577;
    ww(8) = 0.2152638534631577;
    ww(9) = 0.2051984637212957;
    ww(10) = 0.1855383974779378;
    ww(11) = 0.1572031671581936;
    ww(12) = 0.1215185706879032;
    ww(13) = 0.0801580871597600;
    ww(14) = 0.0351194603317520;
    
elseif nn == 15
    
    xx(1) = -0.9879925180204854;
    xx(2) = -0.9372733924007060;
    xx(3) = -0.8482065834104273;
    xx(4) = -0.7244177313601701;
    xx(5) = -0.5709721726085388;
    xx(6) = -0.3941513470775634;
    xx(7) = -0.2011940939974345;
    xx(8) = 0.0000000000000000;
    xx(9) = 0.2011940939974345;
    xx(10) = 0.3941513470775634;
    xx(11) = 0.5709721726085388;
    xx(12) = 0.7244177313601701;
    xx(13) = 0.8482065834104273;
    xx(14) = 0.9372733924007060;
    xx(15) = 0.9879925180204854;
    
    ww(1) = 0.0307532419961166;
    ww(2) = 0.0703660474881081;
    ww(3) = 0.1071592204671718;
    ww(4) = 0.1395706779261542;
    ww(5) = 0.1662692058169939;
    ww(6) = 0.1861610000155621;
    ww(7) = 0.1984314853271116;
    ww(8) = 0.2025782419255613;
    ww(9) = 0.1984314853271116;
    ww(10) = 0.1861610000155621;
    ww(11) = 0.1662692058169939;
    ww(12) = 0.1395706779261542;
    ww(13) = 0.1071592204671718;
    ww(14) = 0.0703660474881081;
    ww(15) = 0.0307532419961166;
    
else
    
    error('n should be less than 15')
    
    
    
end











end